---
layout: post
title: å¿«é€Ÿå®ç° React ä¸šåŠ¡å¼¹çª—ç»„ä»¶
category: study
tags: js
description: å‡å°‘å¯¹ä¸šåŠ¡ç»„ä»¶çš„ä¾µå…¥ï¼Œè½»æ¾æŠ«ä¸Šä¸€å±‚å¼¹çª—ï¼Œè®©ä½ çš„ç»„ä»¶æƒ³å¼¹å°±å¼¹
---

ä¹‹å‰çš„éœ€æ±‚æœ‰ä¸€äº›å¼¹çª—ï¼Œå¼¹çª—å†…å®¹æ¯”è¾ƒå¤æ‚ï¼Œåœ¨ React é¡¹ç›®ä¸­æ€ä¹ˆæ–¹ä¾¿é«˜æ•ˆåœ°å®ç°ä¸€ä¸ªä¸šåŠ¡å¼¹çª—ç»„ä»¶å‘¢ï¼Ÿç»å†äº†ä¸€æ®µæ—¶é—´çš„æ¼”å˜ï¼Œç»ˆäºæ‰¾åˆ°äº†æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•â€¦â€¦

ä¸‹é¢ä»¥ç®€å•çš„è®¾ç½®æ–‡æ¡ˆçš„å¼¹çª—ä¸ºä¾‹åˆ—ä¸¾ä¸€ä¸‹å¼¹çª—çš„å®ç°ã€‚

ä½¿ç”¨çš„åŸºç¡€å¼¹çª—ç»„ä»¶æ˜¯ [antd modal](https://ant.design/components/modal-cn/)ã€‚

![](https://img.alicdn.com/tfs/TB1TQt9qRjTBKNjSZFNXXasFXXa-1052-448.png_500x500)

# ä¸€èˆ¬å†™æ³•

æ¯”è¾ƒå¸¸è§çš„å†™æ³•å°±æ˜¯é€šè¿‡æ ‡ç­¾å®ç°ï¼Œä¹Ÿæ˜¯æˆ‘æœ€å¼€å§‹å¸¸ç”¨çš„ï¼Œä½†æ€»è§‰å¾—ä¸çˆ½ã€‚

ğŸ‰ [å®Œæ•´ demo](https://codesandbox.io/s/q4q7600l5q)

å¼¹çª—ç»„ä»¶çš„å®ç°ï¼š

```
class DialogCustom extends React.Component {
 constructor(props) {
   super(props);
   this.state = { text: '' };
 }

 handleOk = () => {
   this.props.onOk(this.state.text);
   this.props.onClose();
 }

 onChange = (e) => {
   this.setState({ text: e.target.value });
 }

 render() {
   const { visible, onClose } = this.props;

   return (
     <Modal title="è®¾ç½®æ–‡æ¡ˆ" visible={visible} onOk={this.handleOk} onCancel={onClose}>
       <Input value={this.state.text} onChange={this.onChange} />
     </Modal>
   );
 }
}
```

ä½¿ç”¨ç»„ä»¶ï¼š

```
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      visible: false, // è¦å¢åŠ ä¸€ä¸ª visible å¾ˆéº»çƒ¦æœ‰æœ¨æœ‰
      text: ''
    };
  }

  handleOk = (v) => {
    this.setState({ text: v });
  }

  showDialog = () => {
    this.setState({ visible: true });
  }

  handleClose = () => {
    this.setState({ visible: false });
  }

  render() { // åªèƒ½é€šè¿‡æ ‡ç­¾è°ƒç”¨
    return (<div>
      <Button onClick={this.showDialog}>è®¾ç½®æ–‡æ¡ˆ</Button>
      <DialogCustom visible={this.state.visible} onOk={this.handleOk} onClose={this.handleClose} />
      <div>{this.state.text}</div>
    </div>);
  }
}
```

æœ¬æ–¹æ³•çš„éº»çƒ¦ä¹‹å¤„åœ¨äºï¼š

- å®ç°ä¸€ä¸ªå¼¹çª—ç»„ä»¶æ—¶æ¯æ¬¡éƒ½è¦å¼•å…¥ Modal ç»„ä»¶ï¼›

- ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œåªèƒ½ç”¨æ ‡ç­¾çš„æ–¹å¼ï¼Œä¸”éœ€è¦æœ‰ä¸€ä¸ª visible state æ§åˆ¶å¼¹çª—çŠ¶æ€ï¼›

è¿™æ ·å†™ä¸€ä¸ªå…¶å®ä¹Ÿæ²¡ä»€ä¹ˆï¼Œå¤šäº†ä»¥åå°±çƒ¦äº†â€¦â€¦


# å¿«æ·è°ƒç”¨

é’ˆå¯¹ä¸Šé¢ä½¿ç”¨ç»„ä»¶çš„éº»çƒ¦ï¼Œå¸Œæœ›ä½¿ç”¨ç»„ä»¶æ—¶å¯ä»¥é€šè¿‡ `xxx.show()` çš„æ–¹å¼å¿«æ·è°ƒç”¨ï¼Œä¸éœ€è¦æ ‡ç­¾ï¼Œä¸éœ€è¦é€šè¿‡ visible state æ§åˆ¶ã€‚

è§£å†³ï¼šç»™ç»„ä»¶åŠ ä¸Š show æ–¹æ³•ã€‚è·Ÿä¸Šä¸€æ–¹æ³•çš„å·®åˆ«å°±æ˜¯å¢åŠ äº†ä¸€ä¸ª show æ–¹æ³•ï¼Œå¦å¤– `<Modal />` çš„ `visible` å±æ€§ç›´æ¥è®¾ä¸º `true` å³å¯

ğŸ‰ [å®Œæ•´ demo](https://codesandbox.io/s/j46z7o7o99)

å¼¹çª—ç»„ä»¶çš„å®ç°:

```
class DialogCustom extends React.Component {
 static show = params => {
   let container = document.createElement("div");
   document.body.appendChild(container);

   function closeHandle() {
     ReactDOM.unmountComponentAtNode(container);
     document.body.removeChild(container);
     container = null;
   }

   ReactDOM.render(<DialogCustom {...params} onClose={closeHandle} />, container);
 };

 ...

 render() {
   return (<Modal  ... visible={true}>...</Modal>);
 }
}

```

ä½¿ç”¨ç»„ä»¶ï¼š

```
DialogCustom.show({ onOk: this.handleOk }); // è°ƒç”¨ show æƒ³å¼¹å°±å¼¹ï¼Œå¼¹å¾—å“äº®ï¼›ç›´æ¥å¯å…³é—­ï¼Œä¸ç”¨å†å¢åŠ  visible state å»æ§åˆ¶
```

æœ¬æ–¹æ³•çš„éº»çƒ¦ä¹‹å¤„åœ¨äºï¼š

- å®ç°ä¸€ä¸ªå¼¹çª—ç»„ä»¶æ—¶æ¯æ¬¡éƒ½è¦å¼•å…¥ Modalï¼Œéƒ½è¦é‡å†™ä¸€æ¬¡ show æ–¹æ³•

è¿™æ ·å†™å‡ ä¸ªï¼Œå¤šäº†ä»¥åè¿˜æ˜¯çƒ¦äº†â€¦â€¦


# é«˜é˜¶ç»„ä»¶

é’ˆå¯¹ â€œå®ç°ä¸€ä¸ªå¼¹çª—ç»„ä»¶æ—¶æ¯æ¬¡éƒ½è¦å¼•å…¥ Modalï¼Œéƒ½è¦é‡å†™ä¸€æ¬¡ show æ–¹æ³•â€ çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨é«˜é˜¶ç»„ä»¶è§£å†³

ğŸ‰ [å®Œæ•´ demo](https://codesandbox.io/s/v60l9mjmy)

é«˜é˜¶ç»„ä»¶ï¼š

```
const withDialog = WrappedComponent => {
 function EnhancedComponent(props) {
   const { title, onClose, ...others } = props;
   return (<Modal visible={true} title={title || WrappedComponent.title} footer={<div />}>
       <WrappedComponent {...others} onClose={onClose} />
   </Modal>);
 }

 EnhancedComponent.show = params => {
   let container = document.createElement("div");
   document.body.appendChild(container);

   function closeHandle() {
     ReactDOM.unmountComponentAtNode(container);
     document.body.removeChild(container);
     container = null;
   }

   ReactDOM.render(<EnhancedComponent {...params} onClose={closeHandle} />, container);
 };

 return EnhancedComponent;
};

```

è®¾ç½®æ–‡æ¡ˆçš„ç»„ä»¶å‡ ä¹åªè¦å¤„ç†æœ¬èº«çš„é€»è¾‘ï¼Œè·Ÿå¼¹çª—ç›¸å…³çš„æœ‰ä¸¤ä¸ªç‚¹ï¼š

- é«˜é˜¶ç»„ä»¶èµäºˆäº†ä¸šåŠ¡ç»„ä»¶ä¸€ä¸ª onClose çš„å±æ€§ä»¥æ‹¥æœ‰å…³é—­å¼¹çª—çš„æƒåˆ©ï¼Œä¸šåŠ¡ç»„ä»¶è¦æ³¨æ„ä¸‹å…³é—­å¼¹çª—çš„æ—¶æœºã€‚
- footer å°±ç”±ä¸šåŠ¡ç»„ä»¶å…¨æƒæ‰¿åŒ…äº†â€¦â€¦

å¦‚æœä¸éœ€è¦å¼¹çª—äº†ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œç›´æ¥ä½¿ç”¨ SetText å³å¯ï¼ˆæ­¤å¤„åº”è¯¥è¦å†å¤„ç†ä¸‹ footerï¼‰ã€‚

ä¸šåŠ¡ç»„ä»¶ï¼š

```
@withDialog // ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œå¾ˆå…³é”®
class SetText extends React.Component { // åªè¦å¤„ç†æœ¬èº«çš„é€»è¾‘ï¼Œå‡ ä¹ä¸ç”¨åœ¨æ„å¼¹çª—
 static title = "è®¾ç½®æ–‡æ¡ˆ";

 static defaultProps = {
   onClose: () => {}
 };

 constructor(props) {
   super(props);
   this.state = { text: "" };
 }

 onChange = e => {
   this.setState({ text: e.target.value });
 };

 handleOk = () => {
   this.props.onOk(this.state.text);
   this.props.onClose();
 };

 render() {
   return (<div>
     <Input value={this.state.text} onChange={this.onChange} />
     <div>
       <Button onClick={this.handleOk}>ç¡®å®š</Button>
       <Button onClick={this.props.onClose}>å–æ¶ˆ</Button>
     </div>
   </div>);
 }
}
```

ä½¿ç”¨ç»„ä»¶ï¼š

```
SetText.show({ onOk: this.handleOk });
```

æœ¬æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼š

- footer ä¸€å®šéœ€è¦è‡ªå®šä¹‰ï¼Œæ³¨æ„ä¿æŒæ ·å¼ç»Ÿä¸€

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‡ ä¹ä¸ç”¨ä¾µå…¥ä½ çš„ç»„ä»¶ï¼Œä½ çš„ç»„ä»¶å°±å¯ä»¥æŠ«ä¸Šä¸€ä¸ªå¼¹çª—ã€‚

æ³¨ï¼šæ–‡æœ¬æ¡ˆä¾‹åŸºäº antd modal å®ç°ï¼Œä½†ä¸é™äº antd modalï¼Œä½ å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ªåŸºç¡€å¼¹çª—å°±å¯ä»¥å®ç°å¼¹å¼¹å¼¹ã€‚
